<!doctype html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>初等变换辅助学习</title><style type="text/css">#window{display:grid;grid-template-columns:repeat(10,40px);grid-template-rows:repeat(10,40px);gap:0;border:1px solid #ccc;margin-bottom:20px;width:400px;height:400px;background-color:#f0f0f0}.grid-cell{width:40px;height:40px;border:1px solid #000;display:flex;align-items:center;justify-content:center;background-color:#d3d3d3;transition:background-color .3s;cursor:pointer}.highlighted{background-color:rgba(235,235,80,.655)}#coordinates{font-size:18px;font-weight:700;margin-top:30px;margin-bottom:20px}#InputMatrix{display:none;align-items:flex-start;gap:20px;margin-bottom:20px}#InputMatrix.visible{display:flex}.assist-group{display:flex;flex-direction:column;gap:10px;margin-left:20px;width:200px}.action-button{padding:12px 24px;font-size:16px;font-weight:700;background-color:#4a6fa5;color:#fff;border:none;border-radius:6px;cursor:pointer;transition:all .3s ease;min-width:100px}.action-button:hover{background-color:#6b8cb7;transform:translateY(-2px);box-shadow:0 4px 8px rgba(0,0,0,.2)}.action-button:active{transform:translateY(0);box-shadow:0 2px 4px rgba(0,0,0,.2)}#undoButton{background-color:#6c757d}#undoButton:hover{background-color:#5a6268}#nextButton{background-color:#28a745}#nextButton:hover{background-color:#218838}.grid-cell-input{width:60px;height:50px;border:2px solid #007bff;background-color:#fff;text-align:center;font-size:16px;font-weight:700;color:#333;outline:0;box-sizing:border-box;border-radius:4px;padding:0 5px}.grid-cell-input:focus{border-color:#0056b3;box-shadow:0 0 0 3px rgba(0,123,255,.25)}#window.dynamic{transition:all .3s ease}</style><style type="text/css">:root{--primary-color:#4a6fa5;--secondary-color:#6b8cb7;--accent-color:#e76f51;--light-bg:#f8f9fa;--dark-text:#333333;--light-text:#ffffff;--border-color:#ced4da;--shadow:0 4px 6px rgba(0, 0, 0, 0.1);--transition:all 0.3s ease}body{display:flex;flex-direction:column;align-items:center;padding:20px;max-width:1200px;margin:0 auto;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;font-size:16px;background-color:#f0f4f8;color:var(--dark-text);line-height:1.6}h1{color:var(--primary-color);margin-bottom:30px;text-align:center}@keyframes slideInRight{from{transform:translateX(100%);opacity:0}to{transform:translateX(0);opacity:1}}@keyframes slideOutRight{from{transform:translateX(0);opacity:1}to{transform:translateX(100%);opacity:0}}#translate_history{word-wrap:break-word;overflow-wrap:break-word;white-space:normal;max-width:100%;padding:12px;background-color:#f8f9fa;border-radius:4px;margin:15px 0;border:1px solid #e9ecef}#det,#result{width:100%;box-sizing:border-box}.matrix-container{overflow-x:auto;width:100%;margin:15px 0}.more-container{position:fixed;top:20px;right:20px;z-index:1001}.more-button{background-color:var(--primary-color);color:#fff;border:none;padding:8px 16px;border-radius:4px;cursor:pointer;font-size:14px;transition:var(--transition)}.more-button:hover{background-color:var(--secondary-color);transform:translateY(-1px);box-shadow:0 2px 4px rgba(0,0,0,.1)}.dropdown-menu{position:absolute;top:100%;right:0;background-color:#fff;min-width:180px;box-shadow:0 4px 12px rgba(0,0,0,.15);border-radius:4px;border:1px solid var(--border-color);z-index:1000;opacity:0;transform:translateY(-10px);visibility:hidden;transition:all .3s ease}.dropdown-menu.show{opacity:1;transform:translateY(0);visibility:visible}.dropdown-item{display:block;padding:10px 16px;text-decoration:none;color:var(--dark-text);border-bottom:1px solid #f0f0f0;transition:var(--transition)}.dropdown-item:hover{background-color:#f8f9fa;color:var(--primary-color)}.more-container button.dropdown-item{background-color:#e6f3ff;color:#000;border:none;width:100%;text-align:left;cursor:pointer;font-size:14px;font-family:inherit;margin:0;padding:8px 12px}.more-container button.dropdown-item:hover{background-color:#d4e7ff;color:#000}.more-container .dropdown-menu{padding:0}.more-container .dropdown-item{margin:0}.dropdown-item:last-child{border-bottom:none}</style><style type="text/css">table{border-collapse:collapse;margin:20px auto;box-shadow:var(--shadow);background-color:#fff;transition:var(--transition)}table:hover{box-shadow:0 6px 12px rgba(0,0,0,.15)}td{border:1px solid var(--border-color);padding:10px 12px;text-align:center;width:50px;transition:var(--transition)}td:hover{background-color:#f1f7ff}.col-label,.row-label{font-weight:700;background-color:#e9ecef;color:var(--primary-color)}.col-label button,.row-label button{background:0 0;color:var(--primary-color);padding:4px 8px;margin:0;border:1px dashed transparent}.col-label button:hover,.row-label button:hover{background-color:rgba(74,111,165,.1);border-color:var(--primary-color);transform:none;box-shadow:none}input[type=text]{padding:10px 12px;margin-bottom:10px;box-sizing:border-box;border:1px solid var(--border-color);border-radius:4px;font-size:16px;transition:var(--transition)}input[type=text]:focus{outline:0;border-color:var(--primary-color);box-shadow:0 0 0 3px rgba(74,111,165,.2)}.t-i-group{height:42px;padding:10px 12px;border:1px solid var(--border-color);border-radius:4px;font-size:16px;box-sizing:border-box;transition:var(--transition)}.t-i-group:focus{outline:0;border-color:var(--primary-color);box-shadow:0 0 0 3px rgba(74,111,165,.2)}#transform-param,#transform-target{width:140px}#transform-coefficient{width:140px}#transform-operator{padding:10px;border:1px solid var(--border-color);border-radius:4px;background-color:#fff;transition:var(--transition)}#transform-operator:focus{outline:0;border-color:var(--primary-color)}button{margin:0 5px 10px 0;padding:10px 18px;cursor:pointer;background-color:var(--primary-color);color:var(--light-text);border:none;border-radius:4px;font-size:15px;transition:var(--transition);font-weight:500;width:auto;min-width:40px}button:hover{background-color:var(--secondary-color);transform:translateY(-2px);box-shadow:var(--shadow)}button:active{transform:translateY(0)}button#button-compete{background-color:#28a745}button#button-compete:hover{background-color:#218838}button#redo,button#undo{background-color:#6c757d}button#redo:hover,button#undo:hover{background-color:#5a6268}button#button-reset{background-color:#dc3545}button#button-reset:hover{background-color:#c82333}.operator-buttons{display:flex;justify-content:center;gap:5px;margin:15px 0;flex-wrap:wrap;align-items:center}.input-group{display:flex;gap:10px;align-items:center;width:100%;justify-content:center;flex-wrap:wrap;margin-bottom:10px}.shortcut-buttons{display:flex;gap:8px;margin:10px 0}.shortcut-buttons button{padding:8px 12px;font-size:16px}.header-buttons{display:flex;gap:10px;margin-bottom:20px;flex-wrap:wrap;justify-content:center}.hidden{display:none}#arithmetic-symbols{display:flex;flex-direction:column;gap:0}#arithmetic-symbols button{padding:4px 12px;font-size:16px;background-color:#ccc;color:#666;border:1px solid #999}#arithmetic-symbols button:hover{background-color:#bbb;color:#555;border-color:#888}.assist-group{display:flex;flex-direction:column;gap:10px;margin-left:20px;width:200px}.assist-group button{display:block;width:100%;margin:0 0 10px 0}</style><style type="text/css">.popup-box-container{position:fixed;bottom:20px;right:20px;z-index:1000;display:flex;flex-direction:column-reverse;gap:10px;max-width:350px}.popup{position:relative;color:#fff;padding:16px 20px;border-radius:12px;box-shadow:0 8px 25px rgba(0,0,0,.2);animation:slideInUp .3s ease-out;pointer-events:auto;max-width:100%;backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.2);transform:translateY(0);transition:transform .3s ease}.error-popup{background:linear-gradient(135deg,#ff6b6b,#ee5a52)}.warning-popup{background:linear-gradient(135deg,#ffa726,#f57c00)}.success-popup{background:linear-gradient(135deg,#66bb6a,#43a047)}.popup.fade-out{animation:slideOutDown .3s ease-in forwards}.popup::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;border-radius:12px 12px 0 0}.error-popup::before{background:linear-gradient(90deg,#ff9a9e,#fad0c4)}.warning-popup::before{background:linear-gradient(90deg,#ffb74d,#ff9800)}.success-popup::before{background:linear-gradient(90deg,#81c784,#4caf50)}.popup-content{display:flex;align-items:flex-start;gap:12px}.popup-icon{font-size:20px;margin-top:2px;flex-shrink:0}.popup-message{flex:1;font-size:14px;line-height:1.4;margin:0;word-wrap:break-word}.popup-close{background:0 0;border:none;color:#fff;font-size:16px;cursor:pointer;padding:4px;border-radius:50%;transition:background-color .2s;flex-shrink:0;width:24px;height:24px;display:flex;align-items:center;justify-content:center}.popup-close:hover{background-color:rgba(255,255,255,.2)}@keyframes slideInUp{from{transform:translateY(100%);opacity:0}to{transform:translateY(0);opacity:1}}@keyframes slideOutDown{from{transform:translateY(0);opacity:1}to{transform:translateY(100%);opacity:0}}@media (max-width:768px){.popup-box-container{bottom:15px;right:15px;left:15px;max-width:none}.popup{padding:14px 16px;border-radius:10px}.popup-message{font-size:13px}}@media (max-width:480px){.popup-box-container{bottom:10px;right:10px;left:10px;gap:8px}.popup{padding:12px 14px;border-radius:8px}.popup-content{gap:8px}.popup-message{font-size:12px}}</style><style type="text/css">@media (max-width:1024px){body{padding:15px;font-size:15px}#ButtonInputMartix{padding:14px 28px;font-size:16px;margin-bottom:20px}#window{width:350px;height:350px;grid-template-columns:repeat(10,35px);grid-template-rows:repeat(10,35px)}.grid-cell{width:35px;height:35px;font-size:14px}.grid-cell-input{width:50px;height:45px;font-size:15px}#InputMatrix{flex-direction:column;align-items:center;gap:15px}.assist-group{margin-left:0;width:100%;max-width:300px;align-items:center}.action-button{padding:14px 28px;font-size:15px;min-width:120px;width:100%;margin-bottom:8px}#coordinates{font-size:16px;margin-top:20px;margin-bottom:15px}}@media (max-width:768px){body{padding:10px;font-size:14px}#ButtonInputMartix{padding:12px 24px;font-size:15px;width:100%;margin-bottom:15px}#window{width:300px;height:300px;grid-template-columns:repeat(10,30px);grid-template-rows:repeat(10,30px)}.grid-cell{width:30px;height:30px;font-size:12px}.grid-cell-input{width:45px;height:40px;font-size:14px;padding:0 3px}#InputMatrix{gap:12px}.assist-group{max-width:280px;gap:8px}.action-button{padding:12px 20px;font-size:14px;min-width:100px}#coordinates{font-size:15px;margin-top:15px;margin-bottom:12px}}@media (max-width:480px){body{padding:8px;font-size:13px}#ButtonInputMartix{padding:10px 20px;font-size:14px;margin-bottom:12px}#window{width:280px;height:280px;grid-template-columns:repeat(10,28px);grid-template-rows:repeat(10,28px)}.grid-cell{width:28px;height:28px;font-size:11px}.grid-cell-input{width:40px;height:35px;font-size:13px;padding:0 2px;max-width:3}#InputMatrix{gap:10px}.assist-group{max-width:260px;gap:6px}.action-button{padding:10px 16px;font-size:13px;min-width:90px}#coordinates{font-size:14px;margin-top:12px;margin-bottom:10px}#tip{font-size:12px;line-height:1.3}}@media (max-width:320px){body{padding:5px;font-size:12px}#ButtonInputMartix{padding:8px 16px;font-size:13px;margin-bottom:10px}#window{width:250px;height:250px;grid-template-columns:repeat(10,25px);grid-template-rows:repeat(10,25px)}.grid-cell{width:25px;height:25px;font-size:10px}.grid-cell-input{width:35px;height:30px;font-size:12px;padding:0 1px;max-width:2}#InputMatrix{gap:8px}.assist-group{max-width:240px;gap:4px}.action-button{padding:8px 12px;font-size:12px;min-width:80px}#coordinates{font-size:13px;margin-top:10px;margin-bottom:8px}}@media (max-height:500px) and (orientation:landscape){#InputMatrix{flex-direction:row;justify-content:center}.assist-group{margin-left:20px;width:180px}#window{width:280px;height:280px}}@media (-webkit-min-device-pixel-ratio:2),(min-resolution:192dpi){.grid-cell{border-width:.5px}.grid-cell-input{border-width:1px}}@media (hover:none) and (pointer:coarse){.action-button:hover{transform:none;box-shadow:none}.grid-cell:hover{background-color:#d3d3d3}.action-button:active{transform:scale(.98)}.grid-cell-input{font-size:16px}}@media (prefers-color-scheme:dark){body{background-color:#1a1a1a;color:#fff}#window{background-color:#2d2d2d;border-color:#555}.grid-cell{background-color:#3d3d3d;border-color:#666;color:#fff}.grid-cell-input{background-color:#2d2d2d;border-color:#4a90e2;color:#fff}.grid-cell-input:focus{border-color:#1e6fbb}}</style></head><body><header><button id="ButtonInputMartix">录入矩阵</button></header><div class="more-container"><button id="moreButton" class="more-button">更多</button><div id="moreDropdown" class="dropdown-menu"><button class="dropdown-item" id="exportMatrixButton">导出矩阵为二维数组</button> <button class="dropdown-item" id="ButtonQuickInput">导入二维数组为矩阵</button> <a href="https://github.com/awei808/awei" class="dropdown-item" target="_blank">跳转GitHub仓库</a></div></div><div id="InputMatrix"><h1 id="tip"></h1><div><div id="window"></div><p id="coordinates">矩阵维度: 0×0</p><p id="matrixDataDisplay" class="matrix-data-display" style="display:none"></p></div><div class="assist-group"><button id="undoButton" class="action-button">上一步</button> <button id="nextButton" class="action-button">下一步</button></div></div><div class="operator-buttons hidden"><div class="input-group"><input id="transform-target" placeholder="目标行/列 (如 r1, c2)" class="t-i-group"><div id="arithmetic-symbols"><button id="button-change">↔</button> <button id="button-add">+</button> <button id="button-sub">−</button> <button id="button-mul">×</button></div><input id="transform-coefficient" placeholder="系数，默认为1"> <input id="transform-param" placeholder="参数行/列 (如 r1，c2)" class="t-i-group"> <button id="button-translate">执行初等变换</button></div></div><div id="popupBox" class="popup-box-container"></div><script src="https://cdn.jsdelivr.net/npm/mathjs@11.8.0/lib/browser/math.min.js"></script><script>const CONFIG={GRID_SIZE:10,INITIAL_DIMENSION:"0×0",SCREEN_SIZES:{MOBILE_MAX:768,TABLET_MAX:1024,DESKTOP_MIN:1025},DEFAULT_INPUT_DIMENSIONS:{width:60,height:50},STATES:{INIT:"init",SELECT_DIMENSION:"select_dimension",INPUT_ELEMENTS:"input_elements",ELEMENTARY_TRANSFORMATION:"elementary_transformation"}},state={currentHoverCell:null,lastSelectedDimension:CONFIG.INITIAL_DIMENSION,gridCells:[],gridInputs:[],currentState:CONFIG.STATES.INIT,matrixData:null,previousStates:[],rowColumnIndexEventListener:null},elements={windowDiv:document.getElementById("window"),coordinatesDiv:document.getElementById("coordinates"),undoButton:document.getElementById("undoButton"),nextButton:document.getElementById("nextButton"),inputMatrixDiv:document.getElementById("InputMatrix"),buttonInputMatrix:document.getElementById("ButtonInputMartix"),tipDiv:document.getElementById("tip")};function init(){createGrid(),setupEventListeners(),state.currentState=CONFIG.STATES.INIT,updateUIForCurrentState()}function updateUIForCurrentState(){switch(state.currentState){case CONFIG.STATES.INIT:console.log("to 初始状态"),elements.tipDiv.textContent='请点击"录入矩阵"按钮开始',elements.nextButton.textContent="下一步",elements.nextButton.disabled=!0,elements.nextButton.style.opacity="0.6",elements.nextButton.style.cursor="not-allowed",elements.undoButton.disabled=!0,elements.undoButton.style.opacity="0.6",elements.undoButton.style.cursor="not-allowed",disableGridInteraction();break;case CONFIG.STATES.SELECT_DIMENSION:console.log("to 维度选择"),elements.tipDiv.textContent="点击网格选择矩阵大小",elements.nextButton.textContent="下一步",elements.nextButton.disabled=!1,elements.nextButton.style.opacity="1",elements.nextButton.style.cursor="pointer",elements.undoButton.disabled=!0,elements.undoButton.style.opacity="0.6",elements.undoButton.style.cursor="not-allowed",enableGridInteraction();break;case CONFIG.STATES.INPUT_ELEMENTS:console.log("to 输入元素"),console.log(`矩阵维度: ${state.lastSelectedDimension}`),elements.tipDiv.textContent="请在输入框中输入矩阵元素（非‘0’），点击下一步后，空白处将用‘0’填充",elements.nextButton.textContent="下一步",elements.nextButton.disabled=!1,elements.nextButton.style.opacity="1",elements.nextButton.style.cursor="pointer",elements.undoButton.disabled=!1,elements.undoButton.style.opacity="1",elements.undoButton.style.cursor="pointer",enableInputInteraction(),disableGridInteraction();break;case CONFIG.STATES.ELEMENTARY_TRANSFORMATION:console.log("to 初等变换"),console.table(`矩阵数据: ${JSON.stringify(state.matrixData.elements)}`),elements.tipDiv.textContent="可以进行初等变换操作",elements.nextButton.textContent="完成",elements.nextButton.disabled=!0,elements.nextButton.style.opacity="0.6",elements.nextButton.style.cursor="not-allowed",elements.undoButton.disabled=!1,elements.undoButton.style.opacity="1",elements.undoButton.style.cursor="pointer",showElementaryTransformationUI(),disableGridInteraction()}}function handleDimensionSelection(){const highlightedCells=Array.from(elements.windowDiv.querySelectorAll(".grid-cell.highlighted"));if(0===highlightedCells.length)return showWarning("请先选择矩阵维度（点击并拖动网格）"),state.previousStates.pop(),!1;const matrixDimensions=calculateMatrixDimensions(highlightedCells);return removeNonHighlightedCells(),convertHighlightedCellsToInputs(highlightedCells),resizeWindow(matrixDimensions),updateCoordinatesDisplay(`${matrixDimensions.rows}×${matrixDimensions.cols}`),state.matrixData={rows:matrixDimensions.rows,cols:matrixDimensions.cols,elements:Array.from({length:matrixDimensions.rows},()=>Array.from({length:matrixDimensions.cols},()=>""))},!0}function handleDataValidation(){if(state.currentState!==CONFIG.STATES.INPUT_ELEMENTS)return!1;collectMatrixData();const validationResult=validateMatrixData();return validationResult.isValid?(updateCoordinatesDisplay(`${state.matrixData.rows}×${state.matrixData.cols}`),!0):(showError(validationResult.message),!1)}function resetToInitialState(){elements.windowDiv.innerHTML="",unbindRowColumnIndexEvents(),elements.windowDiv.classList.remove("dynamic"),elements.windowDiv.style.width="400px",elements.windowDiv.style.height="400px",elements.windowDiv.style.gridTemplateColumns="repeat(10, 40px)",elements.windowDiv.style.gridTemplateRows="repeat(10, 40px)",elements.windowDiv.style.display="grid",createGrid(),state.gridInputs=[],updateCoordinatesDisplay("0×0"),state.lastSelectedDimension="0×0"}function Next(){state.previousStates.push({state:state.currentState,matrixData:state.matrixData?JSON.parse(JSON.stringify(state.matrixData)):null});let success=!0;switch(state.currentState){case CONFIG.STATES.SELECT_DIMENSION:console.log("维度选择下, next"),success=handleDimensionSelection(),success&&(state.currentState=CONFIG.STATES.INPUT_ELEMENTS);break;case CONFIG.STATES.INPUT_ELEMENTS:console.log("输入元素下, next"),success=handleDataValidation(),success&&(state.currentState=CONFIG.STATES.ELEMENTARY_TRANSFORMATION)}success?updateUIForCurrentState():state.previousStates.pop()}function Undo(){if(0===state.previousStates.length)return void showWarning("没有可撤销的操作");const previousState=state.previousStates.pop(),prevStateType=previousState.state,prevMatrixData=previousState.matrixData?JSON.parse(JSON.stringify(previousState.matrixData)):null;switch(state.currentState===CONFIG.STATES.ELEMENTARY_TRANSFORMATION&&hideElementaryTransformationUI(),state.currentState){case CONFIG.STATES.INPUT_ELEMENTS:console.log("输入元素下, undo"),restoreOriginalGrid();break;case CONFIG.STATES.ELEMENTARY_TRANSFORMATION:console.log("初等变换下, undo"),restoreGridForInputElements()}state.currentState=prevStateType,state.matrixData=prevMatrixData;const dim=state.matrixData?`${state.matrixData.rows}×${state.matrixData.cols}`:CONFIG.INITIAL_DIMENSION;updateCoordinatesDisplay(dim),state.lastSelectedDimension=dim,updateUIForCurrentState()}function startMatrixInput(){const quickInput=document.getElementById("input");if(!quickInput||""===quickInput.value.trim())return state.currentState===CONFIG.STATES.INIT?(state.previousStates.push({state:state.currentState,matrixData:state.matrixData?JSON.parse(JSON.stringify(state.matrixData)):null}),state.currentState=CONFIG.STATES.SELECT_DIMENSION,updateUIForCurrentState(),void elements.inputMatrixDiv.classList.toggle("visible")):void elements.inputMatrixDiv.classList.toggle("visible");handleQuickInputMatrix()}function handleQuickInputMatrix(){if("function"==typeof window.handleQuickInputMatrix&&window.handleQuickInputMatrix!==handleQuickInputMatrix){const success=window.handleQuickInputMatrix();return success&&elements.inputMatrixDiv.classList.remove("visible"),success}return showError("快速录入功能未加载，请检查quickinput.js文件"),!1}function toggleMoreDropdown(event){event.stopPropagation();const moreDropdown=document.getElementById("moreDropdown");moreDropdown&&moreDropdown.classList.toggle("show")}function exportMatrixToArray(){if(!state.matrixData||!state.matrixData.elements)return void showError("没有可导出的矩阵数据");const{rows:rows,cols:cols,elements:elements}=state.matrixData,matrixArray=[];for(let i=0;i<rows;i++){const row=[];for(let j=0;j<cols;j++)row.push(elements[i][j]||"0");matrixArray.push(`[${row.join(", ")}]`)}const matrixString=`[${matrixArray.join(", ")}]`;navigator.clipboard.writeText(matrixString).then(()=>{showSuccess("矩阵数据已复制到剪贴板！");const matrixDataDisplay=document.getElementById("matrixDataDisplay");matrixDataDisplay&&(matrixDataDisplay.textContent=`矩阵数据: ${matrixString}`,matrixDataDisplay.style.display="block");const moreDropdown=document.getElementById("moreDropdown");moreDropdown&&moreDropdown.classList.remove("show")}).catch(err=>{console.error("复制失败:",err),showError("复制失败，请手动复制以下内容: "+matrixString);const matrixDataDisplay=document.getElementById("matrixDataDisplay");matrixDataDisplay&&(matrixDataDisplay.textContent=`矩阵数据: ${matrixString}`,matrixDataDisplay.style.display="block")})}function handleMouseDown(e){e.target.classList.contains("grid-cell")&&updateGrid(e.target)}function handleMouseLeave(){elements.coordinatesDiv.textContent=`矩阵维度: ${state.lastSelectedDimension}`}function updateGrid(cell){const{x:x,y:y}=getCellCoordinates(cell),dimensionText=`${y+1}×${x+1}`;updateCoordinatesDisplay(dimensionText),state.lastSelectedDimension=dimensionText,updateHighlightedCells(x,y)}function setupEventListeners(){elements.windowDiv.addEventListener("mousedown",handleMouseDown),elements.windowDiv.addEventListener("mouseleave",handleMouseLeave),elements.undoButton.addEventListener("click",Undo),elements.nextButton.addEventListener("click",Next),elements.buttonInputMatrix.addEventListener("click",startMatrixInput);const moreButton=document.getElementById("moreButton"),moreDropdown=document.getElementById("moreDropdown");moreButton&&moreDropdown&&(moreButton.addEventListener("click",toggleMoreDropdown),document.addEventListener("click",function(event){moreButton.contains(event.target)||moreDropdown.contains(event.target)||moreDropdown.classList.remove("show")}));const exportMatrixButton=document.getElementById("exportMatrixButton");exportMatrixButton&&exportMatrixButton.addEventListener("click",function(event){event.preventDefault(),exportMatrixToArray()})}function createGrid(){state.gridCells=[];const fragment=document.createDocumentFragment();for(let y=0;y<CONFIG.GRID_SIZE;y++)for(let x=0;x<CONFIG.GRID_SIZE;x++){const cell=document.createElement("div");cell.className="grid-cell",cell.dataset.x=x,cell.dataset.y=y,fragment.appendChild(cell),state.gridCells.push(cell)}elements.windowDiv.appendChild(fragment)}function restoreOriginalGrid(){elements.windowDiv.innerHTML="",elements.windowDiv.classList.remove("dynamic"),elements.windowDiv.style.width="400px",elements.windowDiv.style.height="400px",elements.windowDiv.style.gridTemplateColumns="repeat(10, 40px)",elements.windowDiv.style.gridTemplateRows="repeat(10, 40px)",elements.windowDiv.style.display="grid",createGrid(),state.gridInputs=[],updateCoordinatesDisplay("0×0"),state.lastSelectedDimension="0×0"}function restoreGridForInputElements(){if(state.matrixData){const{rows:rows,cols:cols}=state.matrixData,{width:inputWidth,height:inputHeight}=getInputElementDimensions(),gap=0;elements.windowDiv.classList.add("dynamic"),elements.windowDiv.style.width=cols*(inputWidth+gap)+"px",elements.windowDiv.style.height=rows*(inputHeight+gap)+"px",elements.windowDiv.style.gridTemplateColumns=`repeat(${cols}, ${inputWidth}px)`,elements.windowDiv.style.gridTemplateRows=`repeat(${rows}, ${inputHeight}px)`}else elements.windowDiv.classList.remove("dynamic"),elements.windowDiv.style.width="400px",elements.windowDiv.style.height="400px",elements.windowDiv.style.gridTemplateColumns="repeat(10, 40px)",elements.windowDiv.style.gridTemplateRows="repeat(10, 40px)";if(elements.windowDiv.innerHTML="",state.gridInputs=[],state.gridCells=[],state.matrixData){const{rows:rows,cols:cols,elements:matrixElements}=state.matrixData;for(let row=0;row<rows;row++)for(let col=0;col<cols;col++){const input=document.createElement("input");input.type="text",input.className="grid-cell-input",input.dataset.x=col,input.dataset.y=row,input.value=matrixElements[row][col]||"",elements.windowDiv.appendChild(input),state.gridInputs.push(input)}updateCoordinatesDisplay(`${rows}×${cols}`)}else createGrid(),updateCoordinatesDisplay(CONFIG.INITIAL_DIMENSION)}function convertHighlightedCellsToInputs(highlightedCells){highlightedCells.forEach(cell=>{const input=document.createElement("input");input.type="text",input.className="grid-cell-input",input.dataset.x=cell.dataset.x,input.dataset.y=cell.dataset.y,input.dataset.index=cell.dataset.index,input.placeholder="0",input.maxLength=5,cell.parentNode.replaceChild(input,cell),state.gridInputs=state.gridInputs||[],state.gridInputs.push(input)})}function enableGridInteraction(){elements.windowDiv.addEventListener("mousedown",handleMouseDown),elements.windowDiv.addEventListener("mouseleave",handleMouseLeave)}function disableGridInteraction(){elements.windowDiv.removeEventListener("mousedown",handleMouseDown),elements.windowDiv.removeEventListener("mouseleave",handleMouseLeave)}function enableInputInteraction(){Array.from(elements.windowDiv.querySelectorAll(".grid-cell-input")).forEach(input=>{input.disabled=!1,input.style.backgroundColor="white",input.style.cursor="text"})}function disableInputInteraction(){Array.from(elements.windowDiv.querySelectorAll(".grid-cell-input")).forEach(input=>{input.disabled=!0,input.style.backgroundColor="#f0f0f0",input.style.cursor="not-allowed",console.log("禁用成功")})}function removeNonHighlightedCells(){Array.from(elements.windowDiv.querySelectorAll(".grid-cell")).filter(cell=>!cell.classList.contains("highlighted")).forEach(cell=>{cell.remove()}),state.gridCells=Array.from(elements.windowDiv.querySelectorAll(".grid-cell"))}function collectMatrixData(){Array.from(elements.windowDiv.querySelectorAll(".grid-cell-input")).forEach(input=>{const x=parseInt(input.dataset.x),y=parseInt(input.dataset.y);state.matrixData.elements[y][x]=input.value.trim()})}function validateMatrixData(useDOM=!1){if(!state.matrixData||!state.matrixData.elements)return{isValid:!0,message:"数据处理完成"};const{rows:rows,cols:cols}=state.matrixData;let elements=[],inputs=[];useDOM?inputs=Array.from(elements.windowDiv.querySelectorAll(".grid-cell-input")):elements=state.matrixData.elements;const decimalPattern=/^-?\d+\.\d+$/,fractionPattern=/^-?\d+\/\d+$/;if(useDOM)for(let i=0;i<inputs.length;i++){const input=inputs[i];let value=input.value.trim();const row=Math.floor(i/cols)+1,col=i%cols+1;if(value){if(decimalPattern.test(value))try{const decimalValue=parseFloat(value),fraction=math.fraction(decimalValue);if(1===fraction.d)input.value=fraction.n.toString();else{const fractionString=math.format(fraction,{fraction:"ratio"});input.value=fractionString}}catch(error){return{isValid:!1,message:`第${row}行第${col}列小数转换失败：${value}`}}else if(fractionPattern.test(value))try{const fraction=math.fraction(value);if(1===fraction.d)input.value=fraction.n.toString();else{const simplifiedFraction=math.format(fraction,{fraction:"ratio"});input.value=simplifiedFraction}}catch(error){return{isValid:!1,message:`第${row}行第${col}列分数化简失败：${value}`}}}else input.value="0"}else for(let row=0;row<rows;row++)for(let col=0;col<cols;col++){let value=elements[row][col]?.trim()||"";if(value){if(decimalPattern.test(value))try{const decimalValue=parseFloat(value),fraction=math.fraction(decimalValue);if(1===fraction.d)elements[row][col]=fraction.n.toString();else{const fractionString=math.format(fraction,{fraction:"ratio"});elements[row][col]=fractionString}}catch(error){return{isValid:!1,message:`第${row+1}行第${col+1}列小数转换失败：${value}`}}else if(fractionPattern.test(value))try{const fraction=math.fraction(value);if(1===fraction.d)elements[row][col]=fraction.n.toString();else{const simplifiedFraction=math.format(fraction,{fraction:"ratio"});elements[row][col]=simplifiedFraction}}catch(error){return{isValid:!1,message:`第${row+1}行第${col+1}列分数化简失败：${value}`}}}else elements[row][col]="0"}return{isValid:!0,message:"数据处理完成"}}function calculateMatrixDimensions(highlightedCells){let maxX=0,maxY=0;return highlightedCells.forEach(cell=>{const x=parseInt(cell.dataset.x),y=parseInt(cell.dataset.y);maxX=Math.max(maxX,x),maxY=Math.max(maxY,y)}),{rows:maxY+1,cols:maxX+1}}function hideElementaryTransformationUI(){document.querySelector(".operator-buttons").classList.add("hidden"),unbindRowColumnIndexEvents()}function showElementaryTransformationUI(){const elementaryTransformationDiv=document.querySelector(".operator-buttons");elementaryTransformationDiv&&(elementaryTransformationDiv.classList.remove("hidden"),elementaryTransformationDiv.style.alignItems="center",elementaryTransformationDiv.style.width="100%",elementaryTransformationDiv.style.maxWidth="1000px",elementaryTransformationDiv.style.margin="0 auto"),addRowColumnIndices(),bindRowColumnIndexEvents(),reorganizeLayoutForElementaryTransformation()}function bindRowColumnIndexEvents(){if(state.isRowColumnIndexEventsBound&&state.rowColumnIndexEventListener)return void console.log("行列索引事件监听器已绑定，跳过重复绑定");state.rowColumnIndexEventListener&&(elements.windowDiv.removeEventListener("click",state.rowColumnIndexEventListener),state.rowColumnIndexEventListener=null);const eventListener=function(e){const target=e.target;if(target.id.startsWith("button_add_r")||target.id.startsWith("button_add_c")){const type=target.id.includes("r")?"r":"c",num=target.textContent.replace(type,""),transformTarget=document.getElementById("transform-target"),transformParam=document.getElementById("transform-param");if(transformTarget&&transformParam)if(""===transformTarget.value.trim())transformTarget.value+=type+num;else{const currentParam=transformParam.value.trim(),rowColRegex=/[rc]\d+/g;if(rowColRegex.test(currentParam)){const lastRowColMatch=currentParam.match(rowColRegex);if(lastRowColMatch&&lastRowColMatch.length>0){const lastRowCol=lastRowColMatch[lastRowColMatch.length-1],lastIndex=currentParam.lastIndexOf(lastRowCol);transformParam.value=currentParam.substring(0,lastIndex)+type+num+currentParam.substring(lastIndex+lastRowCol.length)}else transformParam.value+=type+num}else transformParam.value+=type+num}}};elements.windowDiv.addEventListener("click",eventListener),state.rowColumnIndexEventListener=eventListener,state.isRowColumnIndexEventsBound=!0,console.log("行列索引事件监听器已绑定")}function unbindRowColumnIndexEvents(){state.rowColumnIndexEventListener&&(elements.windowDiv.removeEventListener("click",state.rowColumnIndexEventListener),state.rowColumnIndexEventListener=null,state.isRowColumnIndexEventsBound=!1,console.log("行列索引事件监听器已移除"))}function reorganizeLayoutForElementaryTransformation(){document.querySelectorAll(".operator-buttons").forEach(buttonGroup=>{buttonGroup.classList.remove("hidden")});const coordinates=document.getElementById("coordinates");coordinates&&state.matrixData&&(coordinates.textContent=`矩阵维度: ${state.matrixData.rows}×${state.matrixData.cols}`)}function addRowColumnIndices(){const{rows:rows,cols:cols,elements:matrixElements}=state.matrixData,table=document.createElement("table");table.style.borderCollapse="collapse",table.style.margin="0px auto";for(let row=0;row<rows;row++){const tr=document.createElement("tr");for(let col=0;col<cols;col++){const td=document.createElement("td"),cellValue=matrixElements[row][col]||"0";td.textContent=cellValue,td.className="grid-cell-value",td.style.border="1px solid #ccc",td.style.padding="8px 12px",td.style.textAlign="center",td.style.backgroundColor="#f9f9f9",tr.appendChild(td)}const rowIndexTd=document.createElement("td");rowIndexTd.className="row-label";const rowButton=document.createElement("button");rowButton.textContent=`r${row+1}`,rowButton.id=`button_add_r${row+1}`,rowIndexTd.appendChild(rowButton),tr.appendChild(rowIndexTd),table.appendChild(tr)}const colTr=document.createElement("tr");for(let col=0;col<cols;col++){const colTd=document.createElement("td");colTd.className="col-label";const colButton=document.createElement("button");colButton.textContent=`c${col+1}`,colButton.id=`button_add_c${col+1}`,colTd.appendChild(colButton),colTr.appendChild(colTd)}const emptyTd=document.createElement("td");colTr.appendChild(emptyTd),table.appendChild(colTr),elements.windowDiv.innerHTML="",elements.windowDiv.appendChild(table),setTimeout(()=>{const windowWidth=table.offsetWidth,windowHeight=table.offsetHeight;elements.windowDiv.style.width=`${windowWidth}px`,elements.windowDiv.style.height=`${windowHeight}px`,elements.windowDiv.style.gridTemplateColumns="none",elements.windowDiv.style.gridTemplateRows="none",elements.windowDiv.style.overflow="visible",elements.windowDiv.style.display="block"},0)}function updateHighlightedCells(targetX,targetY){clearAllHighlights(),highlightCellsInRange(targetX,targetY)}function clearAllHighlights(){state.gridCells.forEach(cell=>{cell.classList.remove("highlighted")})}function highlightCellsInRange(targetX,targetY){Math.min(targetX,CONFIG.GRID_SIZE-1),Math.min(targetY,CONFIG.GRID_SIZE-1);for(let x=0;x<=targetX;x++)for(let y=0;y<=targetY;y++){const cellIndex=y*CONFIG.GRID_SIZE+x;state.gridCells[cellIndex]&&state.gridCells[cellIndex].classList.add("highlighted")}}function updateCoordinatesDisplay(dimensionText){elements.coordinatesDiv.textContent=`矩阵维度: ${dimensionText}`}function getCellCoordinates(cell){return{x:parseInt(cell.dataset.x),y:parseInt(cell.dataset.y)}}function resizeWindow(dimensions){const{width:inputWidth,height:inputHeight}=getInputElementDimensions();let newWidth=dimensions.cols*(inputWidth+0),newHeight=dimensions.rows*(inputHeight+0);let maxWidth;switch(getScreenSizeType()){case"mobile":maxWidth=window.innerWidth-20;break;case"tablet":maxWidth=window.innerWidth-30;break;default:maxWidth=window.innerWidth-40}newWidth>maxWidth&&(newWidth=maxWidth,newHeight=newHeight*maxWidth/newWidth),elements.windowDiv.classList.add("dynamic"),elements.windowDiv.style.width=`${newWidth}px`,elements.windowDiv.style.height=`${newHeight}px`,elements.windowDiv.style.gridTemplateColumns=`repeat(${dimensions.cols}, ${inputWidth}px)`,elements.windowDiv.style.gridTemplateRows=`repeat(${dimensions.rows}, ${inputHeight}px)`}function getInputElementDimensions(){const tempInput=document.createElement("input");tempInput.className="grid-cell-input",document.body.appendChild(tempInput);const computedStyle=window.getComputedStyle(tempInput),dimensions={width:parseFloat(computedStyle.width),height:parseFloat(computedStyle.height)};return document.body.removeChild(tempInput),dimensions}function getScreenSizeType(){const width=window.innerWidth;return width<=CONFIG.SCREEN_SIZES.MOBILE_MAX?"mobile":width<=CONFIG.SCREEN_SIZES.TABLET_MAX?"tablet":"desktop"}document.addEventListener("DOMContentLoaded",()=>{init(),window.addEventListener("resize",()=>{state.currentState===CONFIG.STATES.INPUT_ELEMENTS&&state.matrixData&&restoreGridForInputElements()})})</script><script>class PopupManager{constructor(){this.popupBox=document.getElementById("popupBox"),this.maxPopups=3,this.popupTimeout=3500,this.currentPopups=new Map,this.init()}init(){this.popupBox||this.createPopupBox()}createPopupBox(){this.popupBox=document.createElement("div"),this.popupBox.id="popupBox",this.popupBox.className="popup-box-container",document.body.appendChild(this.popupBox)}showPopup(message,type="error"){const popupId="popup-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),popupDiv=this.createPopup(message,type,popupId);this.currentPopups.size>=this.maxPopups&&this.removeOldestPopup(),this.popupBox.appendChild(popupDiv),this.currentPopups.set(popupId,popupDiv);const timeoutId=setTimeout(()=>{this.removePopup(popupId)},this.popupTimeout);popupDiv.dataset.timeoutId=timeoutId}createPopup(message,type,popupId){const popupDiv=document.createElement("div");popupDiv.className=`popup ${type}-popup`,popupDiv.id=popupId;let icon="⚠️";return"success"===type&&(icon="✅"),"warning"===type&&(icon="⚠️"),"error"===type&&(icon="❌"),popupDiv.innerHTML=`\n            <div class="popup-content">\n                <div class="popup-icon">${icon}</div>\n                <p class="popup-message">${this.escapeHtml(message)}</p>\n                <button class="popup-close" title="关闭">×</button>\n            </div>\n        `,this.bindCloseButton(popupDiv,popupId),popupDiv}bindCloseButton(popupDiv,popupId){const closeButton=popupDiv.querySelector(".popup-close");closeButton.addEventListener("click",e=>{e.stopPropagation(),this.removePopup(popupId)}),closeButton.addEventListener("keydown",e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),this.removePopup(popupId))})}removeOldestPopup(){if(0===this.currentPopups.size)return;const oldestId=Array.from(this.currentPopups.keys())[0];this.removePopup(oldestId)}removePopup(popupId){const popupDiv=this.currentPopups.get(popupId);if(!popupDiv)return;const timeoutId=popupDiv.dataset.timeoutId;timeoutId&&clearTimeout(parseInt(timeoutId)),this.currentPopups.delete(popupId),popupDiv.classList.add("fade-out"),setTimeout(()=>{popupDiv.parentNode&&popupDiv.parentNode.removeChild(popupDiv)},300)}clearAllPopups(){Array.from(this.currentPopups.keys()).forEach(popupId=>{this.removePopup(popupId)})}escapeHtml(text){const div=document.createElement("div");return div.textContent=text,div.innerHTML}getPopupCount(){return this.currentPopups.size}}const popupManager=new PopupManager;function showPopup(message,type="error"){popupManager.showPopup(message,type)}function showError(message){"function"==typeof showPopup?showPopup(message,"error"):alert(message)}function showSuccess(message){"function"==typeof showPopup?showPopup(message,"success"):alert(message)}function showWarning(message){"function"==typeof showPopup?showPopup(message,"warning"):alert(message)}function clearAllPopups(){popupManager.clearAllPopups()}function clearAllErrors(){clearAllPopups()}window.popupManager=popupManager,window.showPopup=showPopup,window.showError=showError,window.showSuccess=showSuccess,window.showWarning=showWarning,window.clearAllPopups=clearAllPopups,window.clearAllErrors=clearAllErrors,document.addEventListener("DOMContentLoaded",function(){console.log("弹窗系统已初始化")})</script><script>let symbolStatus={currentSymbol:"",activeButton:null};const allowedVariables=["a","b","c","d","m","n","x","y","z","λ"];function setActiveSymbol(symbol,activeButton){symbolStatus.currentSymbol=symbol,symbolStatus.activeButton=activeButton,resetButtonStyles(),activeButton.style.backgroundColor="#4a6fa5",activeButton.style.color="white",activeButton.style.border="2px solid #4a6fa5";document.querySelectorAll("#arithmetic-symbols button").forEach(button=>{button!==activeButton&&(button.style.backgroundColor="#cccccc",button.style.color="#666666",button.style.border="1px solid #999999")})}function resetButtonStyles(){document.querySelectorAll("#arithmetic-symbols button").forEach(button=>{button.style.backgroundColor="",button.style.color="",button.style.border=""})}function getCurrentSymbol(){return symbolStatus.currentSymbol}function initTransformationButtons(){const buttonChange=document.getElementById("button-change"),buttonAdd=document.getElementById("button-add"),buttonSub=document.getElementById("button-sub"),buttonMul=document.getElementById("button-mul"),transformCoefficient=document.getElementById("transform-coefficient"),transformParam=document.getElementById("transform-param"),transformOperator=document.getElementById("transform-operator");buttonChange.addEventListener("click",function(){setActiveSymbol("↔",buttonChange),transformCoefficient.style.visibility="hidden",transformCoefficient.style.opacity="0",transformCoefficient.style.pointerEvents="none",transformParam.style.visibility="visible",transformParam.style.opacity="1",transformParam.style.pointerEvents="auto",transformOperator&&(transformOperator.value="↔")}),buttonAdd.addEventListener("click",function(){setActiveSymbol("+",buttonAdd),transformCoefficient.style.visibility="visible",transformCoefficient.style.opacity="1",transformCoefficient.style.pointerEvents="auto",transformParam.style.visibility="visible",transformParam.style.opacity="1",transformParam.style.pointerEvents="auto",transformOperator&&(transformOperator.value="+")}),buttonSub.addEventListener("click",function(){setActiveSymbol("−",buttonSub),transformCoefficient.style.visibility="visible",transformCoefficient.style.opacity="1",transformCoefficient.style.pointerEvents="auto",transformParam.style.visibility="visible",transformParam.style.opacity="1",transformParam.style.pointerEvents="auto",transformOperator&&(transformOperator.value="−")}),buttonMul.addEventListener("click",function(){setActiveSymbol("×",buttonMul),transformCoefficient.style.visibility="visible",transformCoefficient.style.opacity="1",transformCoefficient.style.pointerEvents="auto",transformParam.style.visibility="hidden",transformParam.style.opacity="0",transformParam.style.pointerEvents="none",transformOperator&&(transformOperator.value="×")}),initTranslateButton(),resetButtonStyles()}function initTranslateButton(){const translateButton=document.getElementById("button-translate");translateButton&&translateButton.addEventListener("click",executeElementaryTransformation)}function executeElementaryTransformation(){try{const targetInput=document.getElementById("transform-target").value.trim(),coefficientInput=document.getElementById("transform-coefficient").value.trim(),paramInput=document.getElementById("transform-param").value.trim(),currentSymbol=getCurrentSymbol(),validationResult=validateTransformationInputs(targetInput,coefficientInput,paramInput,currentSymbol);if(!validationResult.isValid)return showError(validationResult.message),!1;const{targetType:targetType,targetIndex:targetIndex,paramType:paramType,paramIndex:paramIndex,coefficient:coefficient}=validationResult.parsedData;let transformationResult;switch(currentSymbol){case"↔":transformationResult=executeRowColumnSwap(targetType,targetIndex,paramType,paramIndex);break;case"+":case"−":transformationResult=executeRowColumnAddSubtract(targetType,targetIndex,paramType,paramIndex,coefficient,currentSymbol);break;case"×":transformationResult=executeRowColumnMultiply(targetType,targetIndex,coefficient);break;default:return showError("请先选择初等变换操作类型"),!1}return transformationResult.success?(showSuccess(`初等变换执行成功: ${transformationResult.description}`),state.matrixData&&displayMatrixTable(),!0):(showError(`初等变换执行失败: ${transformationResult.message}`),!1)}catch(error){return showError(`执行初等变换时发生错误: ${error.message}`),!1}}function validateTransformationInputs(targetInput,coefficientInput,paramInput,currentSymbol){if(!targetInput)return{isValid:!1,message:"请输入目标行/列"};const targetMatch=targetInput.match(/^([rc])(\d+)$/i);if(!targetMatch)return{isValid:!1,message:"目标行/列格式错误，请使用如 r1, c2 的格式"};const targetType=targetMatch[1].toLowerCase(),targetIndex=parseInt(targetMatch[2])-1;if(!state.matrixData||!state.matrixData.elements)return{isValid:!1,message:"矩阵数据不存在，请先录入矩阵"};const maxIndex="r"===targetType?state.matrixData.rows-1:state.matrixData.cols-1;if(targetIndex<0||targetIndex>maxIndex)return{isValid:!1,message:`目标${"r"===targetType?"行":"列"}索引超出范围`};if(coefficientInput.includes("/0"))return{isValid:!1,message:"系数分母不能为0"};let coefficient=null,paramType=null,paramIndex=null;switch(currentSymbol){case"↔":if(!paramInput)return{isValid:!1,message:"交换操作需要参数行/列"};const paramMatch=paramInput.match(/^([rc])(\d+)$/i);if(!paramMatch)return{isValid:!1,message:"参数行/列格式错误，请使用如 r1, c2 的格式"};paramType=paramMatch[1].toLowerCase(),paramIndex=parseInt(paramMatch[2])-1;const paramMaxIndex="r"===paramType?state.matrixData.rows-1:state.matrixData.cols-1;if(paramIndex<0||paramIndex>paramMaxIndex)return{isValid:!1,message:`参数${"r"===paramType?"行":"列"}索引超出范围`};if(targetType!==paramType)return{isValid:!1,message:"交换操作只能在同行或同列之间进行"};break;case"+":case"−":if(!paramInput)return{isValid:!1,message:"加减操作需要参数行/列"};if(coefficientInput&&""!==coefficientInput.trim()){if(/[a-zA-Zλ]/.test(coefficientInput))return{isValid:!1,message:"系数不能包含未知数"};try{coefficient=parseAndSimplifyCoefficient(coefficientInput)}catch(error){return{isValid:!1,message:`系数格式错误: ${error.message}`}}}else coefficient=1;const addParamMatch=paramInput.match(/^([rc])(\d+)$/i);if(!addParamMatch)return{isValid:!1,message:"参数行/列格式错误，请使用如 r1, c2 的格式"};paramType=addParamMatch[1].toLowerCase(),paramIndex=parseInt(addParamMatch[2])-1;const addParamMaxIndex="r"===paramType?state.matrixData.rows-1:state.matrixData.cols-1;if(paramIndex<0||paramIndex>addParamMaxIndex)return{isValid:!1,message:`参数${"r"===paramType?"行":"列"}索引超出范围`};if(targetType!==paramType)return{isValid:!1,message:"加减操作只能在同行或同列之间进行"};break;case"×":if(!coefficientInput)return{isValid:!1,message:"倍乘操作需要系数"};if(/[a-zA-Zλ]/.test(coefficientInput))return{isValid:!1,message:"系数不能包含未知数"};try{coefficient=parseAndSimplifyCoefficient(coefficientInput)}catch(error){return{isValid:!1,message:`系数格式错误: ${error.message}`}}if("1/1"===coefficient||"1"===coefficient)return{isValid:!1,message:"倍乘系数为1，无效变换"};break;default:return{isValid:!1,message:"请先选择初等变换操作类型"}}return{isValid:!0,message:"输入校验通过",parsedData:{targetType:targetType,targetIndex:targetIndex,paramType:paramType,paramIndex:paramIndex,coefficient:coefficient}}}function parseAndSimplifyCoefficient(mathInput){try{const fraction=math.fraction(mathInput);return math.format(fraction,{fraction:"ratio"})}catch(error){throw new Error("系数格式不支持")}}function parseAndSimplifyPolynomial(expression){try{const parsed=math.parse(expression);let result=math.simplify(parsed).toString();return result=result.replace(/lambda/g,"λ"),result=result.replace(/Lambda/g,"Λ"),result=result.replace(/\(([a-zA-Zλ]+)\)/g,"$1"),result=result.replace(/\((\d+)\)/g,"$1"),result}catch(error){return console.error("多项式解析错误:",error),expression}}function validatePolynomialVariables(expression){const variables=expression.match(/[a-zA-Zλ]/g)||[];for(const variable of variables)if(!allowedVariables.includes(variable))return!1;return!0}function executeRowColumnSwap(targetType,targetIndex,paramType,paramIndex){const matrix=state.matrixData.elements;if("r"===targetType){const temp=matrix[targetIndex];return matrix[targetIndex]=matrix[paramIndex],matrix[paramIndex]=temp,{success:!0,description:`交换第${targetIndex+1}行和第${paramIndex+1}行`}}for(let i=0;i<state.matrixData.rows;i++){const temp=matrix[i][targetIndex];matrix[i][targetIndex]=matrix[i][paramIndex],matrix[i][paramIndex]=temp}return{success:!0,description:`交换第${targetIndex+1}列和第${paramIndex+1}列`}}function executeRowColumnAddSubtract(targetType,targetIndex,paramType,paramIndex,coefficient,operation){coefficient&&""!==coefficient||(coefficient=1);const matrix=state.matrixData.elements,isAddition="+"===operation;if("r"===targetType){for(let j=0;j<state.matrixData.cols;j++){const targetValue=matrix[targetIndex][j],paramValue=matrix[paramIndex][j];try{let mathExpression;mathExpression=isAddition?`(${targetValue}) + (${coefficient})*(${paramValue})`:`(${targetValue}) - (${coefficient})*(${paramValue})`;const result=parseAndSimplifyPolynomial(mathExpression);if(!validatePolynomialVariables(result))throw new Error("表达式包含不允许的变量");matrix[targetIndex][j]=result}catch(error){console.error("多项式计算错误:",error),matrix[targetIndex][j]=isAddition?`(${targetValue})+${coefficient}*(${paramValue})`:`(${targetValue})-${coefficient}*(${paramValue})`}}return{success:!0,description:`${isAddition?"加":"减"}法：第${targetIndex+1}行 ${isAddition?"+":"-"} ${coefficient}×第${paramIndex+1}行`}}for(let i=0;i<state.matrixData.rows;i++){const targetValue=matrix[i][targetIndex],paramValue=matrix[i][paramIndex];try{let mathExpression;mathExpression=isAddition?`(${targetValue}) + (${coefficient})*(${paramValue})`:`(${targetValue}) - (${coefficient})*(${paramValue})`;const result=parseAndSimplifyPolynomial(mathExpression);if(!validatePolynomialVariables(result))throw new Error("表达式包含不允许的变量");matrix[i][targetIndex]=result}catch(error){console.error("多项式计算错误:",error),matrix[i][targetIndex]=isAddition?`(${targetValue})+${coefficient}*(${paramValue})`:`(${targetValue})-${coefficient}*(${paramValue})`}}return{success:!0,description:`${isAddition?"加":"减"}法：第${targetIndex+1}列 ${isAddition?"+":"-"} ${coefficient}×第${paramIndex+1}列`}}function executeRowColumnMultiply(targetType,targetIndex,coefficient){const matrix=state.matrixData.elements;if("r"===targetType){for(let j=0;j<state.matrixData.cols;j++){const currentValue=matrix[targetIndex][j];try{const result=parseAndSimplifyPolynomial(`(${coefficient})*(${currentValue})`);if(!validatePolynomialVariables(result))throw new Error("表达式包含不允许的变量");matrix[targetIndex][j]=result}catch(error){console.error("倍乘计算错误:",error),matrix[targetIndex][j]=`${coefficient}*(${currentValue})`}}return{success:!0,description:`倍乘：第${targetIndex+1}行 × ${coefficient}`}}for(let i=0;i<state.matrixData.rows;i++){const currentValue=matrix[i][targetIndex];try{const result=parseAndSimplifyPolynomial(`(${coefficient})*(${currentValue})`);if(!validatePolynomialVariables(result))throw new Error("表达式包含不允许的变量");matrix[i][targetIndex]=result}catch(error){console.error("倍乘计算错误:",error),matrix[i][targetIndex]=`${coefficient}*(${currentValue})`}}return{success:!0,description:`倍乘：第${targetIndex+1}列 × ${coefficient}`}}document.addEventListener("DOMContentLoaded",function(){setTimeout(initTransformationButtons,100)})</script><script>let quickInputAdded=!1;function initQuickInput(){const buttonQuickInput=document.getElementById("ButtonQuickInput");buttonQuickInput&&buttonQuickInput.addEventListener("click",handleQuickInputClick)}function handleQuickInputClick(){const header=document.querySelector("header");if(quickInputAdded)return;const input=document.createElement("input");input.type="text",input.id="input",input.placeholder="请输入二维数组",input.style.marginLeft="10px",input.style.marginRight="10px",input.style.padding="8px 12px",input.style.border="1px solid #ccc",input.style.borderRadius="4px",input.style.width="200px",header.appendChild(input),quickInputAdded=!0;const buttonInputMatrix=document.getElementById("ButtonInputMartix");buttonInputMatrix&&header.appendChild(buttonInputMatrix)}function handleQuickInputMatrix(){const quickInput=document.getElementById("input");if(!quickInput)return showError("快速录入输入框不存在"),!1;const inputValue=quickInput.value.trim();if(""===inputValue)return showError("请输入二维数组"),!1;const validationResult=validateAndParseMatrix(inputValue);return validationResult.isValid?(state.matrixData={rows:validationResult.rows,cols:validationResult.cols,elements:validationResult.elements},state.currentState=CONFIG.STATES.ELEMENTARY_TRANSFORMATION,displayMatrixTable(),updateUIForCurrentState(),showSuccess(`矩阵录入成功！维度: ${validationResult.rows}×${validationResult.cols}`),!0):(showError(validationResult.message),!1)}function validateAndParseMatrix(input){try{const cleanedInput=input.replace(/\s+/g," ").trim();if(!cleanedInput.startsWith("[")||!cleanedInput.endsWith("]"))return{isValid:!1,message:"请输入有效的二维数组格式，如：[[1,2,3],[4,5,6]]"};let processedInput=cleanedInput;const decimalPattern=/-?\d+\.\d+/g,decimalMatches=cleanedInput.match(decimalPattern);if(decimalMatches)for(const decimal of decimalMatches)try{const decimalValue=parseFloat(decimal),fraction=math.fraction(decimalValue);let fractionString;fractionString=1===fraction.d?fraction.n.toString():math.format(fraction,{fraction:"ratio"}),processedInput=processedInput.replace(decimal,fractionString)}catch(error){console.warn(`小数转换失败: ${decimal}`,error)}const allowedVariables=["a","b","c","d","m","n","x","y","z","λ"],allLetters=(new RegExp(`[^${allowedVariables.join("")}a-zA-Z]`,"g"),processedInput.match(/[a-zA-Zλ]/g)||[]),invalidLetters=[...new Set(allLetters)].filter(letter=>!allowedVariables.includes(letter.toLowerCase()));if(invalidLetters.length>0)return{isValid:!1,message:`发现不允许的未知数: ${invalidLetters.join(", ")}。允许的未知数: ${allowedVariables.join(", ")}`};const matrixData=parseMatrixManually(processedInput);if(!matrixData.isValid)return matrixData;const{rows:rows,cols:cols,elements:rawElements}=matrixData,elements=[];for(let i=0;i<rows;i++){elements[i]=[];for(let j=0;j<cols;j++){let element=rawElements[i][j].trim();if(""===element){elements[i][j]="0";continue}const validationResult=isValidMatrixElement(element);if(!validationResult.isValid)return{isValid:!1,message:`第${i+1}行第${j+1}列的值"${element}"不是有效矩阵元素。${validationResult.message}`};const fractionPattern=/^-?(\d+[a-dm-nxyzλ]*)\/(-?\d+[a-dm-nxyzλ]*)$/,fractionMatch=element.match(fractionPattern);if(fractionMatch)try{const numerator=fractionMatch[1],denominator=fractionMatch[2],numeratorIsNumber=/^-?\d+$/.test(numerator),denominatorIsNumber=/^-?\d+$/.test(denominator);if(numeratorIsNumber&&denominatorIsNumber){const fraction=math.fraction(element);element=1===fraction.d?fraction.n.toString():math.format(fraction,{fraction:"ratio"})}else{const numNumerator=numerator.match(/-?\d+/)?.[0]||"1",numDenominator=denominator.match(/-?\d+/)?.[0]||"1",gcd=math.gcd(parseInt(numNumerator),parseInt(numDenominator));if(gcd>1){const simplifiedNum=parseInt(numNumerator)/gcd,simplifiedDen=parseInt(numDenominator)/gcd,simplifiedNumerator=numerator.replace(numNumerator,simplifiedNum.toString());element=`${simplifiedNumerator}/${denominator.replace(numDenominator,simplifiedDen.toString())}`}}}catch(error){console.warn(`分数化简失败: ${element}`,error)}elements[i][j]=element}}return{isValid:!0,message:"解析成功",rows:rows,cols:cols,elements:elements}}catch(error){return{isValid:!1,message:`解析过程中发生错误: ${error.message}`}}}function parseMatrixManually(matrixStr){try{const innerStr=matrixStr.slice(1,-1).trim();if(""===innerStr)return{isValid:!1,message:"矩阵不能为空"};const rowStrings=innerStr.split(/\s*\]\s*,\s*\[\s*/);rowStrings.length>0&&(rowStrings[0]=rowStrings[0].replace(/^\[\s*/,""),rowStrings[rowStrings.length-1]=rowStrings[rowStrings.length-1].replace(/\s*\]$/,""));const rows=rowStrings.length,elements=[];let cols=0;for(let i=0;i<rows;i++){const rowStr=rowStrings[i].trim();if(""===rowStr)return{isValid:!1,message:`第${i+1}行为空`};const columnElements=splitColumns(rowStr);if(0===i)cols=columnElements.length;else if(columnElements.length!==cols)return{isValid:!1,message:`第${i+1}行列数(${columnElements.length})与第一行(${cols})不一致`};elements.push(columnElements)}return{isValid:!0,rows:rows,cols:cols,elements:elements}}catch(error){return{isValid:!1,message:`矩阵格式解析错误: ${error.message}`}}}function splitColumns(rowStr){const elements=[];let currentElement="",inQuotes=!1,quoteChar="";for(let i=0;i<rowStr.length;i++){const char=rowStr[i];'"'!==char&&"'"!==char||inQuotes?char===quoteChar&&inQuotes?(inQuotes=!1,currentElement+=char):","!==char||inQuotes?currentElement+=char:(elements.push(currentElement.trim()),currentElement=""):(inQuotes=!0,quoteChar=char,currentElement+=char)}return""!==currentElement.trim()&&elements.push(currentElement.trim()),elements}function isValidMatrixElement(str){if(""===str)return{isValid:!0,message:""};const allowedVariables=["a","b","c","d","m","n","x","y","z","λ"];if(/^-?\d+(\.\d+)?$/.test(str))return{isValid:!0,message:""};const fractionPattern=new RegExp("^-?([\\da-dm-nxyzλ]+)/([\\da-dm-nxyzλ]+)$"),fractionMatch=str.match(fractionPattern);if(fractionMatch){const numerator=fractionMatch[1],denominator=fractionMatch[2];if("0"===denominator)return{isValid:!1,message:"分母不能为0"};const variablePattern=new RegExp(`[${allowedVariables.join("")}]`,"g"),invalidVariables=[...numerator.match(variablePattern)||[],...denominator.match(variablePattern)||[]].filter(v=>!allowedVariables.includes(v));return invalidVariables.length>0?{isValid:!1,message:`未知数"${invalidVariables[0]}"不在允许范围内（允许的未知数：${allowedVariables.join(", ")}）`}:{isValid:!0,message:""}}if(allowedVariables.includes(str))return{isValid:!0,message:""};const coefficientMatch=str.match(/^(-?\d+(\.\d+)?)([a-dm-nxyzλ])$/);if(coefficientMatch){const variable=coefficientMatch[3];if(allowedVariables.includes(variable))return{isValid:!0,message:""}}const variablePattern=new RegExp(`[${allowedVariables.join("")}]`,"g"),variablesInStr=str.match(variablePattern);if(variablesInStr){const invalidVariables=variablesInStr.filter(v=>!allowedVariables.includes(v));if(invalidVariables.length>0)return{isValid:!1,message:`未知数"${invalidVariables[0]}"不在允许范围内（允许的未知数：${allowedVariables.join(", ")}）`};if(!/^[0-9a-dm-nxyzλ+\-\.\/\s]+$/.test(str.replace(/\s/g,"")))return{isValid:!1,message:"多项式格式错误，只能包含数字、未知数、加减号、小数点和斜杠"};const cleanedStr=str.replace(/\s/g,"");if(/[+\-]$/.test(cleanedStr))return{isValid:!1,message:"多项式不能以加减号结尾"};if(/[+\-]{2,}/.test(cleanedStr))return{isValid:!1,message:"多项式不能有连续的加减号"};if(/\/{2,}/.test(cleanedStr))return{isValid:!1,message:"多项式不能有连续的斜杠"};if(/^\/|\/$/.test(cleanedStr))return{isValid:!1,message:"多项式不能以斜杠开头或结尾"};const terms=cleanedStr.split(/(?=[+-])/);let hasValidStructure=!0;for(let term of terms){if(""===term)continue;if(!/^[+-]?((\d+(\.\d+)?)?([a-dm-nxyzλ])?(\/(\d+([a-dm-nxyzλ])?)?)?)$/.test(term)){hasValidStructure=!1;break}if("+"===term||"-"===term){hasValidStructure=!1;break}if(term.includes("/")){const parts=term.split("/");if(2===parts.length){const denominator=parts[1];if(/^0$/.test(denominator))return{isValid:!1,message:`分数项"${term}"的分母不能为0`};if(/(^0|[^1-9]0)/.test(denominator))return{isValid:!1,message:`分数项"${term}"的分母不能包含0`}}}}return hasValidStructure?{isValid:!0,message:""}:{isValid:!1,message:"多项式格式错误，请检查各项格式是否正确"}}return{isValid:!1,message:`格式错误。支持：数字、分数、未知数（${allowedVariables.join(", ")}）、多项式`}}function displayMatrixTable(){if(!state.matrixData)return;const{rows:rows,cols:cols,elements:matrixElements}=state.matrixData,table=document.createElement("table");table.style.borderCollapse="collapse",table.style.margin="0px auto";for(let row=0;row<rows;row++){const tr=document.createElement("tr");for(let col=0;col<cols;col++){const td=document.createElement("td"),cellValue=matrixElements[row][col]||"0";td.textContent=cellValue,td.className="grid-cell-value",td.style.border="1px solid #ccc",td.style.padding="8px 12px",td.style.textAlign="center",td.style.backgroundColor="#f9f9f9",tr.appendChild(td)}const rowIndexTd=document.createElement("td");rowIndexTd.className="row-label";const rowButton=document.createElement("button");rowButton.textContent=`r${row+1}`,rowButton.id=`button_add_r${row+1}`,rowIndexTd.appendChild(rowButton),tr.appendChild(rowIndexTd),table.appendChild(tr)}const colTr=document.createElement("tr");for(let col=0;col<cols;col++){const colTd=document.createElement("td");colTd.className="col-label";const colButton=document.createElement("button");colButton.textContent=`c${col+1}`,colButton.id=`button_add_c${col+1}`,colTd.appendChild(colButton),colTr.appendChild(colTd)}const emptyTd=document.createElement("td");colTr.appendChild(emptyTd),table.appendChild(colTr),elements.windowDiv.innerHTML="",elements.windowDiv.appendChild(table),setTimeout(()=>{const windowWidth=table.offsetWidth,windowHeight=table.offsetHeight;elements.windowDiv.style.width=`${windowWidth}px`,elements.windowDiv.style.height=`${windowHeight}px`,elements.windowDiv.style.gridTemplateColumns="none",elements.windowDiv.style.gridTemplateRows="none",elements.windowDiv.style.overflow="visible",elements.windowDiv.style.display="block",elements.inputMatrixDiv.style.display="block"},0),console.log("表格显示成功")}document.addEventListener("DOMContentLoaded",function(){initQuickInput()})</script></body></html>
